<!DOCTYPE html>
<html lang="ur">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Smart Walking App</title>

<style>
body{
    margin:0;
    font-family:Arial, sans-serif;
    background:#0f172a;
    color:#fff;
    display:flex;
    flex-direction:column;
    align-items:center;
    justify-content:center;
    height:100vh;
}
.circle{
    width:220px;
    height:220px;
    border-radius:50%;
    border:10px solid #22c55e;
    display:flex;
    flex-direction:column;
    align-items:center;
    justify-content:center;
    font-size:20px;
    margin-bottom:20px;
}
.steps{
    font-size:36px;
    font-weight:bold;
}
button{
    padding:12px 25px;
    font-size:18px;
    border:none;
    border-radius:8px;
    background:#22c55e;
    color:#000;
    cursor:pointer;
}
.status{
    margin-top:10px;
    font-size:14px;
    color:#94a3b8;
}
</style>
</head>

<body>

<div class="circle">
    <div>قدم</div>
    <div class="steps" id="steps">0</div>
</div>

<button onclick="startCounter()">START</button>
<div class="status" id="status">Ready</div>

<script>
let steps = 0;
let lastMagnitude = 0;
let lastStepTime = 0;
let running = false;
let speed = 0;

function startCounter(){
    if(running) return;
    running = true;
    document.getElementById("status").innerText = "Walking detected...";
    
    // Motion Sensor
    window.addEventListener("devicemotion", motionHandler);
    
    // GPS Speed detection
    if(navigator.geolocation){
        navigator.geolocation.watchPosition(pos=>{
            speed = pos.coords.speed || 0; // meters/sec
        });
    }
}

function motionHandler(event){
    let acc = event.accelerationIncludingGravity;
    if(!acc) return;

    let magnitude = Math.sqrt(
        acc.x * acc.x +
        acc.y * acc.y +
        acc.z * acc.z
    );

    let delta = Math.abs(magnitude - lastMagnitude);
    let now = Date.now();

    // Speed logic
    let speedKm = speed * 3.6;

    // If speed too high (bike / car) → stop counting
    if(speedKm > 15){
        document.getElementById("status").innerText = "Vehicle detected – Steps Paused";
        return;
    }

    // Step detection
    if(delta > 6 && now - lastStepTime > 350){
        steps++;
        lastStepTime = now;
        document.getElementById("steps").innerText = steps;

        if(speedKm > 7){
            document.getElementById("status").innerText = "Running...";
        } else {
            document.getElementById("status").innerText = "Walking...";
        }
    }

    lastMagnitude = magnitude;
}
</script>

</body>
</html>
